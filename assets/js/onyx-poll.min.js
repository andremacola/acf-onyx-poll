!function(){"use strict";(new class{constructor(){this.modalEl="onyx-poll-modal",this.loader="onyx-poll-loader",this.closeButton="onyx-poll-close",this.viewButton="onyx-poll-view",this.voteButton="onyx-poll-vote",this.choicesEls="onyx-poll-choice",this.messageEl="onyx-poll-message"}eventHandlers(){const t={modal:document.getElementById(this.modalEl),loader:document.getElementById(this.loader),closeButton:document.getElementById(this.closeButton),viewButton:document.getElementById(this.viewButton),voteButton:document.getElementById(this.voteButton),choices:document.getElementsByClassName(this.choicesEls)};t.closeButton.onclick=()=>t.modal.remove(),t.viewButton.onclick=()=>console.log("view results"),this.handleVoteEvent(t.choices)}requestVote(t){const e={choice:t.getAttribute("data-choice"),poll:t.getAttribute("data-poll")};return new Promise((t,o)=>{const s=new XMLHttpRequest;s.open("POST",`${onyxpoll.apiurl}onyx/polls/vote`),s.setRequestHeader("Content-Type","application/json"),s.send(JSON.stringify(e)),s.onload=function(){this.status>=200&&this.status<400?t(JSON.parse(this.response)):o("Voting not completed.")}})}requestModal(){return new Promise((t,e)=>{const o=new XMLHttpRequest;o.open("GET",`${onyxpoll.apiurl}onyx/polls/list/?modal=1`),o.send(null),o.onload=function(){this.status>=200&&this.status<400?t(JSON.parse(this.response)):e("Poll cannot be loaded.")}})}prepareModal(){const t=document.getElementById(this.modalEl);null!=t&&this.requestModal().then(e=>this.renderModal(e,t)).catch(t=>console.warn(t))}renderModal(t,e){e.innerHTML=`\n\t\t\t<div id='onyx-poll-wrapper-${t.id}'>\n\t\t\t\t<p class='onyx-poll-question'>${t.title}</p>\n\t\t\t\t<ul id="onyx-poll-choices-${t.id}" class='onyx-poll-choices'></ul>\n\n\t\t\t\t<div id="onyx-poll-footer-${t.id}" class="onyx-poll-footer">\n\t\t\t\t\t<p id="${this.messageEl}" class='${this.messageEl}'></p>\n\t\t\t\t\t<p class='onyx-poll-results'></p>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<span id="${this.loader}" class="${this.loader}"></span>\n\t\t\t<span id="${this.closeButton}" class="${this.closeButton}"></span>\n\t\t`;const o=document.getElementById(`onyx-poll-footer-${t.id}`);t.results.total&&(o.innerHTML+=`<a href="#" id="${this.viewButton}" class="${this.viewButton}">${onyxpoll.labels.view}</a>`);const s=document.getElementById(`onyx-poll-choices-${t.id}`);for(const e of t.answers){const o=document.createElement("li");o.setAttribute("data-choice",e.option),o.setAttribute("data-poll",t.id),o.className="onyx-poll-choice",o.textContent=e.answer,s.appendChild(o)}this.eventHandlers()}togglePollActivation(t,e=!0){let o,s;e?(o="loading",s="active"):(o="active",s="loading"),t.classList.remove(o),t.classList.add(s)}handleMessage(t,e){const o=document.getElementById(this.messageEl);o.classList.remove("error","success","warn"),o.classList.add(e),o.textContent=t}handleVoteEvent(t){const e=this,o=document.getElementById(this.messageEl);for(let s=0;s<t.length;s++)t[s].addEventListener("click",(function(){const t=this.parentNode.parentNode.parentNode;e.togglePollActivation(t,!1),e.requestVote(this).then((function(t){console.log(t),o.classList.remove("error"),o.classList.add("success")})).catch((function(){e.togglePollActivation(t,!0),e.handleMessage(onyxpoll.labels.error,"error")}))}))}}).prepareModal()}();