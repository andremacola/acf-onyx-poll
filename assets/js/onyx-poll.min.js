!function(){"use strict";class t{constructor(){this.response=[],this.prefix="onyx-poll",this.mpoll=document.querySelector("#onyx-poll-modal"),this.polls=document.querySelectorAll(".onyx-poll-widget"),this.element={},this.name={parent:this.prefix,modal:this.prefix+"-modal",widget:this.prefix+"-widget",wrapper:this.prefix+"-wrapper",question:this.prefix+"-question",list:this.prefix+"-choices",choice:this.prefix+"-choice",footer:this.prefix+"-footer",message:this.prefix+"-message",total:this.prefix+"-total",voteButton:this.prefix+"-vote",viewButton:this.prefix+"-view",closeButton:this.prefix+"-close",loader:this.prefix+"-loader",events:!1},this.submitVote=this.submitVote.bind(this),this.preparePolls()}preparePolls(){const t=[];this.mpoll&&!this.getCookie("onyx_poll_modal")&&t.push(this.requestPoll(this.mpoll.getAttribute("data-poll")).then(t=>{"error"!==t.code?this.events=this.renderTemplate(t,this.mpoll):(this.mpoll=this.mpoll.remove(),console.log("Warn Modal: "+t.message))}).catch(t=>console.log(t))),this.polls.length>=1&&this.polls.forEach(e=>{t.push(this.requestPoll(e.getAttribute("data-poll")).then(t=>{"error"!==t.code?this.events=this.renderTemplate(t,e):(console.log("Warn: "+t.message),e.classList.add("onyx-poll-invalid"),e.innerHTML=""+t.message)}).catch(t=>console.log(t)))}),Promise.all(t).then(()=>{this.events&&this.eventHandlers()})}requestPoll(t){const e=`${onyxpoll.apiurl}onyx/polls/list/?id=${t}`;return new Promise((s,o)=>{t||o("requestPoll: Empty or invalid poll ID.");const l=this,i=new XMLHttpRequest;i.open("GET",e),i.send(null),i.onload=function(){if(this.status>=200&&this.status<400){const t=JSON.parse(this.response);l.response[t.id]=t,s(t)}else o("Poll cannot be loaded.")}})}requestVote(t){const e={choice:t.getAttribute("data-choice"),poll:t.getAttribute("data-poll")};return new Promise((t,s)=>{const o=this,l=new XMLHttpRequest;l.open("POST",onyxpoll.apiurl+"onyx/polls/vote"),l.setRequestHeader("Content-Type","application/json"),l.send(JSON.stringify(e)),l.onload=function(){const e=JSON.parse(this.response);o.response[e.poll]=e,this.status>=200&&this.status<400?t(e):s(e)}})}renderTemplate(t,e){const s=this.getCookie("onyx_poll_limit_"+t.id);return e.innerHTML=`\n\t\t\t<div id='${this.name.wrapper}-${t.id}' class="${this.name.wrapper}">\n\t\t\t\t<p class='${this.name.question}'>${t.title}</p>\n\t\t\t\t<ul class='${this.name.list}'></ul>\n\t\t\t\t<div class="${this.name.footer}">\n\t\t\t\t\t<p class='${this.name.message}'></p>\n\t\t\t\t\t${t.results?`\n\t\t\t\t\t\t<p class='${this.name.total}'>\n\t\t\t\t\t\t\t<strong>${onyxpoll.labels.total}: </strong>\n\t\t\t\t\t\t\t<span></span>\n\t\t\t\t\t\t</p>\n\t\t\t\t\t`:""}\n\t\t\t\t\t${void 0===t.results||t.expired||s?"":`\n\t\t\t\t\t\t<a href="#" class="onyx-poll-ft-btn ${this.name.voteButton}">${onyxpoll.labels.vote}</a>\n\t\t\t\t\t\t<a href="#" class="onyx-poll-ft-btn ${this.name.viewButton}">${onyxpoll.labels.view}</a>\n\t\t\t\t\t`}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<span class="${this.name.loader}"><span class="spinner"></span></span>\n\t\t\t${e.id===this.name.modal?`\n\t\t\t\t<span class="${this.name.closeButton}"></span>\n\t\t\t`:""}\n\t\t`,e.list=e.querySelector("."+this.name.list),t.answers.forEach(o=>{const l=document.createElement("li");l.setAttribute("data-choice",o.option),l.setAttribute("data-poll",t.id),l.innerHTML=`\n\t\t\t\t${t.has_image?`<span class='image'><img loading='lazy' src='${o.image}' title='${o.answer}' alt='${o.answer}'></span>`:""}\n\t\t\t\t<span class='answer'>${o.answer}</span>`,t.expired||s||(l.className=this.name.choice),e.list.appendChild(l)}),(t.expired||s)&&this.showResults(!1,e),!0}eventHandlers(){if(this.element.choices=document.querySelectorAll("."+this.name.choice),this.element.voteButton=document.querySelectorAll("."+this.name.voteButton),this.element.viewButton=document.querySelectorAll("."+this.name.viewButton),this.element.closeButton=document.querySelector("."+this.name.closeButton),this.mpoll&&!this.getCookie("onyx_poll_modal")&&(this.element.modal=document.getElementById(this.name.modal),this.element.modal.classList.add("active","show"),this.element.closeButton.onclick=()=>{onyxpoll.modaltime>=1&&(console.log("cookie created"),this.createCookie("onyx_poll_modal",1,onyxpoll.modaltime)),this.element.modal.remove()}),this.element.viewButton)for(let t=0;t<this.element.viewButton.length;t++)this.element.viewButton[t].onclick=()=>this.showResults(event,!1),this.element.voteButton[t].onclick=()=>this.showPoll();for(let t=0;t<this.element.choices.length;t++)this.element.choices[t].addEventListener("click",this.submitVote)}submitVote(t){t.preventDefault();const e=t.target,s=e.closest("."+this.name.parent);this.togglePollLoader(s,!1),this.requestVote(e).then(function(t){this.togglePollLoader(s,!0),this.handleMessage(s,t.message,t.code),s.classList.add("voted"),"success"==t.code&&e.classList.add("choosed"),s.id===this.name.modal&&onyxpoll.modaltime>=1&&this.createCookie("onyx_poll_modal",1,onyxpoll.modaltime),void 0!==t.results?s.querySelector("."+this.name.viewButton).click():s.querySelector("."+this.name.list).remove()}.bind(this)).catch(function(t){console.warn(t.message),s.classList.add("voted"),this.togglePollLoader(s,!0),this.handleMessage(s,t.message,"error")}.bind(this))}showResults(t,e){t&&t.preventDefault(),e=t?t.target.closest("."+this.name.parent):e;const s=this.response[e.getAttribute("data-poll")];e.classList.add("view"),e.querySelector(`.${this.name.total} span`).textContent=s.results.total;const o=this.getCookie("onyx_poll_choice_"+s.id);o&&e.querySelector(`li[data-choice="${o}"]`).classList.add("choosed");e.querySelectorAll(`.${this.name.list} li`).forEach((t,e)=>{const o=s.answers[e].votes,l=s.answers[e].percent,i=l>=1?l.toFixed(2)+"%":"0%";let n=`${o} ${onyxpoll.labels.votes} / ${i}`;2==s.results.type?n=`${o} ${onyxpoll.labels.votes}`:1==s.results.type&&(n=""+i),t.removeEventListener("click",this.submitVote),t.style.setProperty("--choicePercentage",""+i),t.style.setProperty("--choiceResult",`"${n}"`)})}showPoll(){event.preventDefault();const t=event.target.closest("."+this.name.parent);t.classList.remove("view");t.querySelectorAll("."+this.name.choice).forEach(t=>{t.addEventListener("click",this.submitVote),t.classList.remove("choosed"),t.style.removeProperty("--choicePercentage"),t.style.removeProperty("--choiceResult")})}handleMessage(t,e,s){const o=t.querySelector("."+this.name.message);o.classList.remove("error","success","warn","not_allowed"),o.classList.add(s),o.textContent=e}togglePollLoader(t,e=!0){let s,o;e?(s="loading",o="active"):(s="active",o="loading"),t.classList.remove(s),t.classList.add(o)}getCookie(t){for(var e=t+"=",s=decodeURIComponent(document.cookie).split(";"),o=0;o<s.length;o++){for(var l=s[o];" "==l.charAt(0);)l=l.substring(1);if(0==l.indexOf(e))return l.substring(e.length,l.length)}return""}createCookie(t,e,s){var o;if(s){var l=new Date;l.setTime(l.getTime()+60*s*60*1e3),o="; expires="+l.toUTCString()}else o="";document.cookie=t+"="+e+o+"; path=/"}}window.acf?window.acf.addAction("render_block_preview/type=acf-onyx-poll",(function(){new t})):new t}();