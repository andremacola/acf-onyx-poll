!function(){"use strict";(new class{constructor(){self=this,this.pollParent="onyx-poll",this.modalEl="onyx-poll-modal",this.loader="onyx-poll-loader",this.closeButton="onyx-poll-close",this.viewButton="onyx-poll-view",this.voteButton="onyx-poll-vote",this.choicesEl="onyx-poll-choice",this.messageEl="onyx-poll-message",this.totalEl="onyx-poll-total",this.listChoicesEl="onyx-poll-choices",this.pollWrapper="onyx-poll-wrapper",this.footerEl="onyx-poll-footer",this.pollQuestion="onyx-poll-question",this.results=null}eventHandlers(){const t={parent:document.querySelector(`.${this.pollParent}`),modal:document.querySelector(`.${this.modalEl}`),loader:document.querySelector(`.${this.loader}`),closeButton:document.querySelector(`.${this.closeButton}`),viewButton:document.querySelector(`.${this.viewButton}`),voteButton:document.querySelector(`.${this.voteButton}`),choices:document.querySelectorAll(`.${this.choicesEl}`),totalEl:document.querySelector(`.${this.totalEl} span`)};t.closeButton.onclick=()=>t.modal.remove(),void 0!==this.results.results&&(t.viewButton.onclick=()=>this.showResults(t),t.voteButton.onclick=()=>this.showPoll(t)),this.handleVoteEvent(t)}requestVote(t){const e={choice:t.getAttribute("data-choice"),poll:t.getAttribute("data-poll")};return new Promise((t,s)=>{const o=new XMLHttpRequest;o.open("POST",`${onyxpoll.apiurl}onyx/polls/vote`),o.setRequestHeader("Content-Type","application/json"),o.send(JSON.stringify(e)),o.onload=function(){this.status>=200&&this.status<400?(self.results=JSON.parse(this.response),t(JSON.parse(this.response))):s("Voting not completed.")}})}requestModal(){return new Promise((t,e)=>{const s=new XMLHttpRequest;s.open("GET",`${onyxpoll.apiurl}onyx/polls/list/?modal=1`),s.send(null),s.onload=function(){this.status>=200&&this.status<400?(self.results=JSON.parse(this.response),t(self.results)):e("Poll cannot be loaded.")}})}prepareModal(){const t=document.getElementById(`${this.modalEl}`);null!=t&&this.requestModal().then(e=>this.renderModal(e,t)).catch(t=>console.warn(t))}renderModal(t,e){e.innerHTML=`\n\t\t\t<div id='${this.pollWrapper}-${t.id}' class="${this.pollWrapper}">\n\t\t\t\t<p class='${this.pollQuestion}'>${t.title}</p>\n\t\t\t\t<ul class='${this.listChoicesEl}'></ul>\n\t\t\t\t<div class="${this.footerEl}">\n\t\t\t\t\t<p class='${this.messageEl}'></p>\n\t\t\t\t\t${t.results?`\n\t\t\t\t\t\t<p class='${this.totalEl}'>\n\t\t\t\t\t\t\t<strong>${onyxpoll.labels.total}: </strong>\n\t\t\t\t\t\t\t<span></span>\n\t\t\t\t\t\t</p>\n\t\t\t\t\t`:""}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<span class="${this.loader}"><span class="spinner"></span></span>\n\t\t\t<span class="${this.closeButton}"></span>\n\t\t`;const s=document.querySelector(`.${this.footerEl}`);void 0!==t.results&&(s.innerHTML+=`\n\t\t\t\t<a href="#" class="onyx-poll-ft-btn ${this.voteButton}">${onyxpoll.labels.vote}</a>\n\t\t\t\t<a href="#" class="onyx-poll-ft-btn ${this.viewButton}">${onyxpoll.labels.view}</a>`);const o=document.querySelector(`.${this.listChoicesEl}`);for(const e of t.answers){const s=document.createElement("li");s.setAttribute("data-choice",e.option),s.setAttribute("data-poll",t.id),s.className=this.choicesEl,s.textContent=e.answer,o.appendChild(s)}e.classList.add("active"),this.eventHandlers()}submitVote(){const t=this.parentNode.parentNode.parentNode;self.togglePollActivation(t,!1),self.requestVote(this).then(function(e){self.togglePollActivation(t,!0),self.handleMessage(e.message,e.code),t.classList.add("voted"),"success"==e.code&&this.classList.add("choosed"),void 0!==e.results?document.querySelector(`.${self.viewButton}`).click():document.querySelector(`.${self.listChoicesEl}`).remove()}.bind(this)).catch((function(){self.togglePollActivation(t,!0),self.handleMessage(onyxpoll.labels.error,"error")}))}togglePollActivation(t,e=!0){let s,o;e?(s="loading",o="active"):(s="active",o="loading"),t.classList.remove(s),t.classList.add(o)}handleMessage(t,e){const s=document.querySelector(`.${this.messageEl}`);s.classList.remove("error","success","warn","not_allowed"),s.classList.add(e),s.textContent=t}handleVoteEvent(t){const e=t.choices;for(let t=0;t<e.length;t++)e[t].addEventListener("click",this.submitVote)}showResults(t){const e=this.results;t.parent.classList.add("view"),t.totalEl.textContent=e.results.total;const s=function(t){for(var e=t+"=",s=decodeURIComponent(document.cookie).split(";"),o=0;o<s.length;o++){for(var l=s[o];" "==l.charAt(0);)l=l.substring(1);if(0==l.indexOf(e))return l.substring(e.length,l.length)}return""}(`onyx_poll_cookie_${e.id}`);s&&document.querySelector(`li[data-choice="${s}"]`).classList.add("choosed");for(let s=0;s<t.choices.length;s++){const o=t.choices[s],l=e.answers[s].votes,n=e.answers[s].percent.toFixed(2)+"%";let i=`${l} ${onyxpoll.labels.votes} / ${n}`;2==this.results.results.type?i=`${l} ${onyxpoll.labels.votes}`:1==this.results.results.type&&(i=`${n}`),o.removeEventListener("click",this.submitVote),o.style.setProperty("--choicePercentage",`${n}`),o.style.setProperty("--choiceResult",`"${i}"`)}}showPoll(t){t.parent.classList.remove("view");for(let e=0;e<t.choices.length;e++){const s=t.choices[e];s.addEventListener("click",this.submitVote),s.style.removeProperty("--choicePercentage"),s.style.removeProperty("--choiceResult")}}}).prepareModal()}();